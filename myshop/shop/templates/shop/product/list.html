{% extends "shop/base.html" %}
{% load static %}

{% block title %}
    {% if category %}
        {{ category.name }}
    {% elif query %}
        Поиск: {{ query }}
    {% else %}
        Магазин техники
    {% endif %}
{% endblock %}

{% block content %}

{% if not category and not query %}
<section class="hero">
    <div class="hero-content">
        <h1>Техника для дома, работы и игр</h1>
        <p>Смартфоны, ноутбуки, компьютеры, аксессуары</p>
        <a href="{% url 'shop:catalog' %}" class="hero-btn">
            Перейти в каталог
        </a>
    </div>
</section>
{% endif %}


<!-- POPULAR CATEGORIES -->
{% if not category and not query %}
<section class="category-tiles">
    {% for c in popular_categories %}
        {% with 'img/categories/'|add:c.slug|add:'.jpg' as bg %}
            <a href="{{ c.url }}"
               class="category-tile"
               style="background-image: url('{% static bg %}')">
                <span>{{ c.name }}</span>
            </a>
        {% endwith %}
    {% endfor %}
</section>
{% endif %}


<!-- PRODUCTS -->
<section id="products" class="product-section">

    <h2 class="section-title">
        {% if category %}
            {{ category.name }}
        {% elif query %}
            Результаты поиска
        {% else %}
            Популярное
        {% endif %}
    </h2>

    <div class="product-grid">

        {% if products %}
            
            {% if not category and not query %}
                {% for product in products|slice:":4" %}
                    <div class="product-card">
                        <a href="{{ product.get_absolute_url }}">
                            <img src="{% if product.image %}
                                        {{ product.image.url }}
                                      {% else %}
                                        {% static 'img/no_image.png' %}
                                      {% endif %}">
                            <h3>{{ product.name }}</h3>
                        </a>

                        <div class="product-bottom">
                            <span class="price">{{ product.price }} ₽</span>
                            <a href="{{ product.get_absolute_url }}" class="buy-btn">
                                Купить
                            </a>
                        </div>
                    </div>
                {% endfor %}
            {% else %}
                {% for product in products %}
                    <div class="product-card">
                        <a href="{{ product.get_absolute_url }}">
                            <img src="{% if product.image %}
                                        {{ product.image.url }}
                                      {% else %}
                                        {% static 'img/no_image.png' %}
                                      {% endif %}">
                            <h3>{{ product.name }}</h3>
                        </a>

                        <div class="product-bottom">
                            <span class="price">{{ product.price }} ₽</span>
                            <a href="{{ product.get_absolute_url }}" class="buy-btn">
                                Купить
                            </a>
                        </div>
                    </div>
                {% endfor %}
            {% endif %}

        {% else %}
            <p class="no-products">Товары не найдены.</p>
        {% endif %}

    </div>


    <!-- ===== ПАГИНАЦИЯ ===== -->
    {% if products.paginator.num_pages > 1 %}
    <div class="pagination">

        {% if products.has_previous %}
            <a href="?page={{ products.previous_page_number }}&q={{ query }}&sort={{ current_sort }}">
                &lsaquo;
            </a>
        {% endif %}

        {% for num in products.paginator.page_range %}
            {% if products.number == num %}
                <span class="active">{{ num }}</span>
            {% elif num >= products.number|add:-2 and num <= products.number|add:2 %}
                <a href="?page={{ num }}&q={{ query }}&sort={{ current_sort }}">
                    {{ num }}
                </a>
            {% endif %}
        {% endfor %}

        {% if products.has_next %}
            <a href="?page={{ products.next_page_number }}&q={{ query }}&sort={{ current_sort }}">
                &rsaquo;
            </a>
        {% endif %}

    </div>
    {% endif %}

</section>

{% endblock %}